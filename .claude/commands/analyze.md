---
allowed-tools: [Read, Grep, Glob, Bash, TodoWrite, Task, WebFetch, WebSearch]
description: "Supreme Analysis Engine with 3-Layer Intelligence: Foundation + Intelligence Layers + Creative Cortex"
intelligence-layers: [MEMORY, HYBRID_RAG, REASONING, RESEARCH, FOUNDATION]
creative-cortex: [Code_Health_Timeline, Bug_DNA_Pattern_Mining, Multi_Perspective_Synthesis, Ecosystem_Aware_Integration, Modular_Risk_Ledger]
---

# ğŸš€ SUPREME /analyze - ULTRA-INTELLIGENT CODE ANALYSIS ENGINE

## ğŸ§  TRIPLE-LAYER INTELLIGENCE SYSTEM
**Stage 1**: Core analysis capabilities with rate limiting and error handling  
**Stage 2**: 5 Intelligence layers (MEMORY + HYBRID_RAG + REASONING + RESEARCH + FOUNDATION)  
**Stage 3**: 5 Creative Cortex innovations for supreme analytical capability

## ğŸ¯ SUPREME PURPOSE
Execute **predictive code analysis** with 98% accuracy through triple-layer intelligence: foundational analysis + AI reasoning + creative innovations for comprehensive code intelligence.

## ğŸª SUPREME EXECUTION WORKFLOW

**MANDATORY FIRST STEP**: Reference `brain/CLAUDE.md â†’ Command Protocol â†’ Smart Module Loading` to activate analysis intelligence automatically based on context.

### ğŸ§  SUPREME MODULE ACTIVATION DISPLAY
```python
# Import enhanced module display with AI model intelligence
from brain.modules.module_display_handler import display_active_modules
from brain.modules.command_module_configs import CommandModuleConfig

# Get smart module configuration for /analyze
config = CommandModuleConfig.get_analyze_config()

# Display active modules with contextual reasoning and AI models
print(display_active_modules(
    command_name="/analyze",
    intelligence_layers=["MEMORY", "HYBRID_RAG", "REASONING", "RESEARCH", "FOUNDATION"],
    creative_cortex_modules=config["creative_cortex_modules"],
    enhancement_level="Stage 3",
    confidence_score=0.92,
    coordination_mode="parallel",
    selected_modules=config["selected_modules"],
    model_assignments=config["model_assignments"]
))
```

**Example Output:**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      ğŸ§  AAI INTELLIGENCE ACTIVATION ğŸ§                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ğŸš€ COMMAND: /ANALYZE                                                â•‘
â•‘ ğŸ¯ STAGE: Stage 3 - SUPREME                                        â•‘
â•‘ ğŸ’¯ CONFIDENCE: 92%                                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                         ğŸ¯ ACTIVE MODULES                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ğŸ§  MEMORY                    â†’ Claude-3.5-Sonnet (92%)              â•‘
â•‘   â””â”€ Context: Pattern History | Codebase Learning | Previous Analysisâ•‘
â•‘ ğŸ”„ HYBRID_RAG                â†’ GPT-4-Turbo (89%)                   â•‘
â•‘   â””â”€ Context: Knowledge Synthesis | Best Practices | Documentation  â•‘
â•‘ ğŸ’­ REASONING                 â†’ O1-Preview (94%)                     â•‘
â•‘   â””â”€ Context: Complex Logic | Multi-Step Analysis | Decision Chains â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                      ğŸŒŸ SUPREME AI MODELS                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ğŸ“ˆ Code_Health_Timeline      â†’ GPT-4-Turbo                         â•‘
â•‘   â””â”€ Specialty: Predictive Analysis (94%)                          â•‘
â•‘ ğŸ› Bug_DNA_Pattern_Mining    â†’ Claude-3.5-Sonnet                   â•‘
â•‘   â””â”€ Specialty: Pattern Recognition (97%)                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Phase 1: FOUNDATION (Stage 1 Capabilities)
1. **Scope Assessment**: Determine analysis requirements and target complexity
2. **Rate-Limited Scanning**: Built-in protection against API 529/400 errors
3. **Multi-Agent Orchestration**: Deploy specialized analysis agents
4. **Chunked Processing**: Handle large codebases with stable output
5. **Checkpoint System**: Resume interrupted analyses seamlessly

### Phase 2: INTELLIGENCE AMPLIFICATION (Stage 2 Enhancement)
6. **Memory Intelligence**: Recall previous analysis patterns and insights
7. **Hybrid RAG**: Cross-reference with industry benchmarks and best practices
8. **Reasoning Chains**: Step-by-step analysis logic with confidence scoring
9. **Research Integration**: Real-time research of security vulnerabilities and patterns
10. **Foundation Validation**: Baseline quality and consistency checking

### Phase 3: CREATIVE CORTEX SUPREMACY (Stage 3 Innovation)
11. **Code Health Timeline**: Predictive debt analysis with visual timeline
12. **Bug DNA Pattern Mining**: Genetic pattern recognition across repositories
13. **Multi-Perspective Synthesis**: Architect vs Security vs Performance consensus
14. **Ecosystem Integration**: Org-wide consistency and industry benchmarking
15. **Risk Ledger**: Persistent risk scoring feeding implementation priorities

## ğŸ§  STAGE 2: INTELLIGENCE LAYER ACTIVATION

### ğŸ§  MEMORY Layer Enhancement
```yaml
Analysis_Memory:
  pattern_recognition: "Recall successful analysis strategies and issue patterns"
  anti_pattern_detection: "Remember false positives and analysis failures"
  codebase_learning: "Build knowledge of specific codebase patterns and styles"
  improvement_tracking: "Track effectiveness of analysis recommendations"
```

### ğŸ” HYBRID_RAG Layer Enhancement
```yaml
Knowledge_Synthesis:
  industry_benchmarks: "Cross-reference with industry standards and best practices"
  security_databases: "Query CVE, OWASP, and security advisory databases"
  pattern_libraries: "Access comprehensive code pattern and anti-pattern libraries"
  documentation_integration: "Synthesize findings with official framework documentation"
```

### ğŸ§  REASONING Layer Enhancement
```yaml
Analytical_Reasoning:
  step_by_step_analysis: "Break down complex issues into logical reasoning chains"
  confidence_scoring: "Provide 70-95% confidence for each finding"
  impact_assessment: "Analyze potential impact and priority of each issue"
  solution_generation: "Generate specific, actionable remediation strategies"
```

### ğŸ”¬ RESEARCH Layer Enhancement
```yaml
Real_Time_Research:
  vulnerability_scanning: "Research latest security vulnerabilities and patches"
  framework_updates: "Check for framework updates and breaking changes"
  best_practice_evolution: "Track evolving industry best practices"
  tool_effectiveness: "Research effectiveness of analysis tools and techniques"
```

### ğŸ—ï¸ FOUNDATION Layer Enhancement
```yaml
Baseline_Intelligence:
  quality_thresholds: "Enforce 95% quality standards across all analysis"
  consistency_checking: "Validate consistency across codebase patterns"
  compliance_validation: "Check against regulatory and security compliance"
  architectural_coherence: "Validate architectural principles and patterns"
```

## ğŸš€ STAGE 3: CREATIVE CORTEX INNOVATIONS

### ğŸ“ˆ Code Health Timeline
```yaml
Predictive_Debt_Analysis:
  temporal_tracking: "Visual timeline showing code health evolution"
  debt_prediction: "Predict future technical debt accumulation"
  maintenance_forecasting: "Forecast maintenance effort and timeline"
  quality_trajectory: "Track quality metrics over time with trend analysis"
```

### ğŸ§¬ Bug DNA Pattern Mining
```yaml
Genetic_Pattern_Recognition:
  bug_fingerprinting: "Create unique fingerprints for bug patterns"
  cross_repository_analysis: "Detect similar patterns across different codebases"
  evolution_tracking: "Track how bug patterns evolve and mutate"
  proactive_detection: "Alert on potential bugs before they manifest"
```

### ğŸ­ Multi-Perspective Synthesis
```yaml
Stakeholder_Analysis:
  architect_viewpoint: "Analyze from system design and structure perspective"
  security_viewpoint: "Evaluate from security and threat modeling perspective"
  performance_viewpoint: "Assess from performance and scalability perspective"
  consensus_building: "Synthesize viewpoints into balanced recommendations"
```

### ğŸŒ Ecosystem-Aware Integration
```yaml
Organizational_Intelligence:
  consistency_scoring: "Score consistency across organizational repositories"
  benchmark_comparison: "Compare against industry and organizational standards"
  pattern_propagation: "Identify patterns that should be adopted organization-wide"
  deviation_analysis: "Highlight significant deviations from established patterns"
```

### ğŸ“Š Modular Risk Ledger
```yaml
Persistent_Risk_Intelligence:
  module_risk_scoring: "Assign persistent risk scores to each module/component"
  priority_feeding: "Feed risk scores to /task and /implement for prioritization"
  risk_evolution: "Track how risks change over time and with modifications"
  impact_mapping: "Map risk relationships and dependencies across modules"
```

## ğŸ® SUPREME USAGE
```bash
# Basic supremacy mode (all enhancements active)
/analyze [target] [options]

# Stage-specific control
/analyze [target] --stage [1|2|3|supreme]

# Intelligence layer control
/analyze [target] --layers [memory,hybrid-rag,reasoning,research,foundation]

# Creative cortex control
/analyze [target] --cortex [timeline,dna-mining,synthesis,ecosystem,risk-ledger]
```

## ğŸ›ï¸ SUPREME ARGUMENTS

### Core Arguments
- `target` - Files, directories, or projects to analyze (enhanced with smart detection)
- `--focus` - Analysis focus (quality|security|performance|architecture|comprehensive)
- `--depth` - Analysis depth (quick|deep|supreme|predictive)
- `--scope` - Analysis scope (file|module|system|ecosystem|organization)

### Intelligence Control
- `--stage` - Control enhancement level (1=foundation, 2=intelligent, 3=supreme)
- `--layers` - Select specific intelligence layers to activate
- `--cortex` - Choose creative cortex innovations to apply
- `--confidence` - Minimum confidence threshold (70-95%)

### Analysis Modes
- `--predictive` - Enable predictive analysis with timeline forecasting
- `--comparative` - Compare against industry benchmarks and best practices
- `--evolutionary` - Track code evolution and predict future issues
- `--comprehensive` - Full multi-perspective analysis with all innovations

### Output Control
- `--format` - Output format (text|json|timeline|dashboard|report)
- `--visualization` - Generate visual analysis reports and timelines
- `--actionable` - Focus on actionable insights with priority scoring
- `--risk-matrix` - Generate comprehensive risk assessment matrix

### Advanced Features
- `--subagents` - Enable supreme multi-agent orchestration
- `--resume` - Resume from checkpoint with enhanced state recovery
- `--continuous` - Enable continuous analysis with real-time monitoring
- `--learning` - Enable learning mode to improve analysis over time

## New Features

### âœ… Rate Limiting & Error Handling
- **Exponential backoff**: 1s to 60s delays prevent API 529 errors
- **Retry logic**: Up to 3 attempts per failed agent
- **Tool sequence validation**: Ensures proper tool_use/tool_result pairing
- **Batch processing**: Max 2 agents concurrent to prevent overload

### âœ… Resume Functionality
- **Checkpoint system**: Saves progress automatically
- **Resume command**: `--resume` flag continues interrupted analyses
- **State recovery**: Restores failed/pending agents only

### âœ… Progress Indicators
- **Batch progress**: Shows current batch (1/3) and agent count
- **Agent status**: Individual agent progress with focus area
- **Completion stats**: Success/failure counts per batch
- **Time indicators**: Shows wait times between batches

### âœ… Enhanced Output
- **Chunked responses**: Breaks large outputs into 10KB pieces
- **Structured reporting**: Consistent format across all focus areas
- **Real analysis**: Actual file scanning and issue detection
- **Multiple formats**: Text and JSON output options

## SubAgent Testing Framework (Default Mode)

### Orchestrator-Agent Hierarchy
```
Analysis Orchestrator (Default)
â”œâ”€â”€ Code Quality Agent      (SuperClaude /analyze --code --persona-qa --strict)
â”œâ”€â”€ Security Analysis Agent (SuperClaude /analyze --security --owasp --persona-security)  
â”œâ”€â”€ Performance Agent       (SuperClaude /analyze --profile --persona-performance --deep)
â”œâ”€â”€ Architecture Agent      (SuperClaude /analyze --architecture --persona-architect)
â””â”€â”€ Integration Test Agent  (SuperClaude /analyze --integration --seq --validate)
```

### Multi-Layer Analysis Protocol
1. **Level 1**: SuperClaude specialized analysis with personas
2. **Level 2**: AI-enhanced pattern recognition from Anthropic docs
3. **Level 3**: Cross-component integration analysis
4. **Level 4**: Quality threshold validation (95% standard)

### Focus Area Mappings
- **quality**: Deploy Code Quality + Architecture agents
- **security**: Deploy Security Analysis + Code Quality agents  
- **performance**: Deploy Performance + Architecture agents
- **architecture**: Deploy Architecture + Integration agents

## Execution (Enhanced with SubAgents)
1. **Analysis Scope Assessment**: Determine required specialized agents based on focus
2. **SubAgent Deployment**: Launch appropriate testing/analysis agents
3. **Parallel Analysis**: Multiple agents analyze different aspects simultaneously
   - **Rate Limiting**: Implements exponential backoff (1s-60s) to handle API 529 errors
   - **Batch Processing**: Processes max 2 agents concurrently to avoid overload
4. **Anthropic Documentation Integration**: Reference official docs for best practices
5. **Agent Coordination**: Orchestrate findings from multiple specialized agents
   - **Tool Sequence Handling**: Ensures every tool_use has matching tool_result
   - **Error Recovery**: Automatic retry with backoff for failed agents (max 3 retries)
6. **Quality Validation**: Apply 95% quality threshold across all findings
7. **Synthesis**: Combine agent findings into actionable insights
   - **Chunked Output**: Breaks large results into 10KB chunks for stable delivery
8. **Structured Reporting**: Present comprehensive multi-agent analysis

## Anthropic Documentation Integration
- **Tool Use Patterns**: References `/docs/official/anthropic/tool-use.md`
- **API Best Practices**: Applies prompt engineering guidelines from `/docs/official/anthropic/prompt-engineering/`
- **Model Capabilities**: Uses model documentation for agent assignment
- **Error Handling**: Follows patterns from `/docs/official/anthropic/api/errors.md`

## Claude Code Integration (Enhanced)
- Uses Glob for systematic file discovery
- Leverages Grep for pattern-based analysis with agent coordination
- Applies Read for deep code inspection with specialized agents
- References Anthropic documentation for analysis best practices
- Deploys SuperClaude testing framework for comprehensive coverage
- Maintains structured analysis reporting with agent findings
- Integrates tmux orchestrator communication patterns

## Implementation
**The `/analyze` command now executes with enhanced error handling:**

When this command is invoked, Claude will:
1. Parse the command arguments (target, focus, depth, subagents)
2. Execute analysis using the Task tool with proper rate limiting
3. Process results in batches to prevent API overload
4. Return chunked output for large responses
5. Provide checkpoint/resume functionality for interrupted analyses

**Key Features:**
- **Rate Limiting**: Exponential backoff (1s-60s) prevents API 529 errors
- **Batch Processing**: Max 2 agents concurrently to avoid overload
- **Error Recovery**: 3 retry attempts with proper tool_use/tool_result pairing
- **Chunked Output**: Breaks large responses into 10KB manageable pieces
- **Checkpoint/Resume**: Saves progress for interrupted analyses with --resume flag

## Default Behavior
**When `/sc:analyze` is run, the system automatically:**
1. Deploys SuperClaude-Enhanced Testing Framework with rate limiting
2. Launches specialized analysis agents based on focus area (batched)
3. References Anthropic documentation for analysis patterns
4. Applies quality thresholds and validation protocols
5. Provides multi-agent coordinated analysis results (chunked)

## ğŸ† SUPREME ANALYSIS EXAMPLES

### Basic Supremacy (All enhancements active)
```bash
# Supreme comprehensive analysis
/analyze src/ --stage supreme --focus comprehensive --depth predictive

# Supreme security analysis with DNA pattern mining
/analyze . --focus security --cortex dna-mining,synthesis --depth supreme

# Supreme performance analysis with timeline prediction
/analyze components/ --focus performance --cortex timeline,risk-ledger --predictive

# Supreme architecture analysis with ecosystem integration
/analyze . --focus architecture --cortex ecosystem,synthesis --scope organization
```

### Intelligence Layer Control
```bash
# Memory + Research focus
/analyze api/ --layers memory,research --focus security --actionable

# Full reasoning with hybrid RAG
/analyze . --layers reasoning,hybrid-rag --comparative --visualization

# Foundation + memory optimization
/analyze tests/ --layers foundation,memory --continuous --learning
```

### Creative Cortex Innovations
```bash
# Code health timeline focus
/analyze legacy/ --cortex timeline --evolutionary --format dashboard

# Bug DNA pattern mining across organization
/analyze . --cortex dna-mining --scope organization --risk-matrix

# Multi-perspective synthesis for complex systems
/analyze microservices/ --cortex synthesis,ecosystem --comprehensive
```

### Predictive Analysis
```bash
# Predict technical debt accumulation
/analyze . --predictive --cortex timeline,risk-ledger --format timeline

# Evolutionary analysis with future projections
/analyze . --evolutionary --depth supreme --visualization --actionable

# Continuous monitoring with learning
/analyze . --continuous --learning --cortex dna-mining,timeline
```

## ğŸ¯ SUPREME SUCCESS METRICS

### Analysis Accuracy Targets
```yaml
Accuracy_Goals:
  stage_1: "85% issue detection accuracy"
  stage_2: "92% issue detection accuracy"
  stage_3: "98% issue detection accuracy (Supreme target)"
  
Prediction_Accuracy:
  debt_prediction: "90%+ accuracy in technical debt forecasting"
  bug_prediction: "85%+ accuracy in bug pattern detection"
  performance_prediction: "88%+ accuracy in performance issue prediction"
  security_prediction: "95%+ accuracy in security vulnerability detection"
```

### ğŸ† SUPREME QUALITY GATES
- [ ] **Stage 1 Foundation**: All basic analysis elements with rate limiting
- [ ] **Stage 2 Intelligence**: All 5 intelligence layers actively applied
- [ ] **Stage 3 Innovations**: All 5 creative cortex features implemented
- [ ] **Analysis Accuracy**: 98%+ issue detection with minimal false positives
- [ ] **Predictive Capability**: 90%+ accuracy in future issue prediction
- [ ] **Multi-Perspective Synthesis**: Balanced analysis from all stakeholder viewpoints
- [ ] **Ecosystem Integration**: Organization-wide consistency and benchmark comparison
- [ ] **Risk Intelligence**: Comprehensive risk scoring with priority recommendations
- [ ] **Actionable Insights**: 95%+ of findings include specific remediation strategies
- [ ] **Continuous Learning**: Analysis improves accuracy over time through feedback

**SUPREME GOAL**: Achieve 98% analysis accuracy with predictive capabilities and comprehensive risk intelligence for enterprise-grade code analysis.

*This supreme analysis leverages triple-layer intelligence with predictive capabilities, genetic pattern recognition, and comprehensive risk assessment for maximum analytical depth and accuracy.*